<html>
	<head>
		<script src='lib/jquery/jquery.js'></script>
		<script src='canvas-designer-widget.js'></script>
		<link rel="stylesheet" href="../../libraries/css/metro-all.css">
		<script src="../../libraries/js/metro.js"></script>
		<script src="../../js/file_manager.js"></script>
		<script src="../../js/save-data.js"></script>
		<style>
			.button.rounded {
				min-width: 4.5em;
			}
			.loc_btn.active {
				border: 2px solid orange;
				
			}
			.panel-x {
				width: 100% !important;
			}
		</style>
		<script>
			$(document).on('click', '#load_file', function(){
				var id = $('li.current-select .file_id').val();
				if($('li.current-select .file_id').attr('name') == 'proj')
					var storage = window.sessionStorage.getItem('projectFiles');
				else
					var storage = window.sessionStorage.getItem('userFiles');
					
				var arr = JSON.parse(storage);
				designer.setPoints( arr.DATA[id]['FILE_PATH'] );
				$('.info-box').find('.closer').click();
			});
			$(document).on('click', '#save_file', function(){
				if($('.loc_btn.active').text() == 'Cloud') {
					$('#save_form').submit();
					if($('#file_name').val().length > 0) {
						designer.getPoints(function(array){
							var data = JSON.stringify(array);
							saveDataToCloud(data, $('#file_name').val(), 'eCraft Plan');
						});
					}
				}
			});
			$(document).on('click', '#save_file_local', function(){
				if($('.loc_btn.active').text() == 'Local') {
					$('#save_form').submit();
					if($('#file_name').val().length > 0) {
						designer.getPoints(function(array){
							var data = JSON.stringify(array);
							saveDataToLocal(data, $('#file_name').val(), 'eCraft Plan', '.eidea');
						});
					}
				}
			});
			$(document).on('change', '#load_local_file', function(e){
				var file = e.target.files[0];
				
				var ext = file.name.split('.').pop().toLowerCase();
				if(ext != 'eidea'){
					$('#invalid_local_ext').show();
					return;
				}
				
				if (!file) {
					return;
				}
				var reader = new FileReader();
				reader.onload = function(e) {
					var arr = JSON.parse(e.target.result);
					console.log(arr.toolid);
					if(arr.toolid != 3){
						$('#invalid_local_file').show();
						return;
					}
					designer.setPoints( arr.data );
					$('.info-box').find('.closer').click();
					return;
				};
				reader.readAsText(file);
			});
		</script>
	</head>
	<body>
		<input type='image' id='save' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAGMAAABjAGzlHTDAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPNQTFRF////AP//AICAM5mZK6qqM7OZLrmiQKqVM6qZQK+fNq6hPbaeOq6iN7GbO7GdNbCeOK+fN7OfN7CeObCfOLOeOLCeOrOdOLCeObGcOLKdOrGcObKeOLOcOrKeObKeOLOdObKcObOdOLKdOLKeOrGdObKcOrKcObGcOrOcOrGdObKcObOdOLGeObGdOLKdObKdOrKcOrKdOLKcObGdObKcOrOdObKeObOdOrKeObOdOLOdObKdObKdObKdOLKdObKdObKdObOcObKdObKeObKdObOdObKdObKdObKdObKdObKeObKdObKdObKdObKdObKdObKdPSWefgAAAFB0Uk5TAAECBQYKCwwPEBMVFhcaHSAlKi0yNzlESElLTE1PWVtna21xc3R3eXyAgYKDlJWZm5+jrrCxsrS6u77Kzc7Q09rc4OHl5ujp7O3u9/n7/f4xoUSUAAAA5UlEQVQYGc3B10LCQBQE0EkQEbtgB8WOS1QC1tgAlWIj8/9f4yLJzWKCz5yDybO0ebC3lsY46zc+tb63gkQVhj5PbMS5NDiIKdHkb8GULR6XehzxPo1IocO4AkT+iwnOIa4oPKU8Dr0sI9SmyAAZBvz7DQx1KaBR9A8xMPNKAY2GfQDZB0ag0fAxi/QjQw1HQVNOg+IMOxQ5BHIUd7igqFr4ZVUpOmgx4lrQLJeRN7RpqNmAXaPhGrc01VOpOk2nOOKIZpOm3jymnvmPXQD5Lsf5rmBg7pLJnlYRWCyW1V/l7QVMih+HTpmHexlS8wAAAABJRU5ErkJggg==' style='width: 40px; height: auto;'>
		<script>
			var designer = new CanvasDesigner();
			designer.widgetHtmlURL = 'widget.html'; 
			designer.widgetJsURL = 'widget.js';     
		</script>
		<script>
			designer.appendTo(document.body || document.documentElement);
			$(document).on('click', '#save', function(){
				//var toolName = window.parent.$('.window').find('.title').text().trim();
				var toolName = 'eCraft Plan';
				openDialog(toolName, '.eidea');
			});
		</script>
	</body>
</html>
