<html>

<head>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <script src="../libraries/js/jquery-3.2.1.min.js"></script>
    <script src="../libraries/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../libraries/css/bootstrap.min.css">

    <script src="js/SelfEvaluationManager.js"></script>

    <style>
        header,
        footer {
            padding: 1em;
            color: white;
            background-color: black;
            clear: left;
            text-align: center;
        }

        body {
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Roboto", "Ubuntu", "Helvetica Neue", sans-serif;
            line-height: 1.5;
            font-style: normal;
            font-weight: 400;

        }

        .category {
            margin: 10px;
            border: 1px solid #ddd;
            border: 1px solid rgba(86, 61, 124, .2);
            padding: 1em;
        }

        .category:focus-within,
        .category:hover {
            box-shadow: 0 0 20px rgba(33, 33, 33, .2);
        }

        .category-footer {
            padding-top: 1em;
            margin-top: 10px;
            border-top: 0.5px dimgray dotted;
        }

        @media screen and (min-width: 990px) {
            select {
                float: right;
                clear: both;
            }
        }
    </style>

    <script>

        $(document).ready(function () {

            getActivityCategories(getActivityId(), function (result, status) {

                var list = JSON.parse(result);

                $('#activityTitle').append(list.DATA[0].Title);
                $('#activitiDesc').append(list.DATA[0].Description);

                for (i = 0; i < list.DATA.length; i++) {
                    var riga = list.DATA[i];

                    var html = "<div id=\"category_" + riga.CategoryId + "\" class=\"category row-fluid container-fluid \">";
                    html += "<div class=\"row-fluid  container-fluid category-header\">    <div class=\"categoryTitle col-xs-12\">";
                    html += "<h4>" + riga.CategoryName + "</h4>    </div> </div> <div class=\"row-fluid  container-fluid category-body\">";

                    //category criteria
                    html += "<div id=\"category_" + riga.CategoryId + "-criterias\" class=\"col-sm-6 col-md-5\" style=\"padding-left: 0px; padding-right:opx;\"> </div>";

                    //students remarks
                    html += "<div class=\"col-sm-4 col-md-5\" style=\"padding-bottom: 10px;\">        <textarea rows=\"5\" style=\"width: 100%;\" placeholder=\"Students remarks\"></textarea>    </div>";

                    //self-evaluation
                    html += "<div class=\"col-sm-2\">        <input type=\"number\" style=\"width: 100px\" placeholder=\"self-evaluation\" />    </div> </div>";

                    //teacher evaluation
                    html += "<div class=\"row-fluid container-fluid category-footer\">    <div class=\"col-md-2 container-fluid\">        <span><strong>Teacher evaluation: </strong></span>        <span>";
                    //TODO TROVARE MODO PIÃ¹ CARINO PER SCRIVERE IL VALORE MAGARI SENZA USARE L'INPUT
                    html += "<input type=\"number\" style=\"width: 130px;\" placeholder=\"Teacher evaluation\" disabled/>        </span>    </div>";
                    //teacher remark
                    html += "<div class=\"col-md-10\" style=\"text-align: justify; text-justify: inter-word;\">        <p>            <strong> Teacher note:</strong> TODO";
                    //TODO
                    html += "</p>    </div></div></div>";

                    $('#categoryContainer').append(html);

                    getCategoryCriterias(riga.CategoryId, addCriterias);

                }
            });
        });

        function addCriterias(result, status) {

            var list = JSON.parse(result);

            var gruppedCriterias = groupCriteriaValues(list.DATA);

            var html = "";

            console.log("CATEGORY: " + list.DATA[0].Category);

            $.each(gruppedCriterias, function (index, criteria) {
                html += "<div class=\"row container\" style=\"width: 100%; padding-bottom: 5px; padding-right: 0px; padding-left: 0px; margin:0px; \">";
                html += "<div class=\"col-md-8\">" + criteria.Name + "</div>  <div class=\"col-md-4\">  <select id=\"category_" + criteria.Category + "-criteria_" + criteria.CritId + "-value\"> <option value=\"\">-</option>";

                console.log("category ID:" + criteria.Category + " criteria -->" + criteria.Name);

                for (i = 0; i < criteria.CritValues.length; i++) {
                    html += "<option value=\"" + criteria.CritValues[i] + "\">" + criteria.CritValues[i] + "</option>";
                }

                html += "</select></div> </div>";
            });

            console.log(html);
            $('#category_' + list.DATA[0].Category + '-criterias').append(html);
        }

        function groupCriteriaValues(list) {

            var grouppedCritValues = Object.values(list.reduce((result, {
                CritId,
                Name,
                Value,
                Category
            }) => {
                // Create new group
                if (!result[CritId]) result[CritId] = {
                    CritId,
                    Name,
                    Category,
                    CritValues: [],
                };
                // Append to group
                result[CritId].CritValues.push(
                    Value
                );
                return result;
            }, {}));

            return grouppedCritValues;
        }

        function getActivityId() {
            var parameters = location.search.substring(1).split("&");

            var temp = parameters[0].split("=");
            id = unescape(temp[1]);

            return id;
        }

    </script>

</head>


<header>

    <h1 id="activityTitle"></h1>

    <p id="activitiDesc"></p>

</header>


<body>

    <div id="categoryContainer" class="container-fluid ">

    </div>
    <!--CATEGORY CONTAINER END-->
</body>

</html>